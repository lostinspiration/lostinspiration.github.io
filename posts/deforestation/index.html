<!DOCTYPE html><script type="module">function t(){const s=document.documentElement.classList.contains("dark")?"dark":"light",e=document.querySelector("iframe.giscus-frame");e&&e.contentWindow.postMessage({giscus:{setConfig:{theme:s}}},"https://giscus.app")}const n=new MutationObserver(t);n.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]});window.onload=()=>{t()};</script> <html lang="en" class="bg-[var(--page-bg)] transition text-[14px] md:text-[16px]" data-overlayscrollbars-initialize data-astro-cid-sckkx6r4 style="--bannerOffset: 15vh;--banner-height-home: 65vh;--banner-height: 35vh;--configHue: 250;--page-width: 75rem;"> <head><title>Deforestation (Logging) - Lost Inspiration</title><meta charset="UTF-8"><meta name="description" content="Logging — The Stack, Fundamentals, and the hard won experience that has continued to pay dividens. With bonus content of extending it into SQL Server"><meta name="author" content="Stephen Kichka"><meta property="og:site_name" content="Lost Inspiration"><meta property="og:url" content="https://www.kichka.dev/posts/deforestation/"><meta property="og:title" content="Deforestation (Logging) - Lost Inspiration"><meta property="og:description" content="Logging — The Stack, Fundamentals, and the hard won experience that has continued to pay dividens. With bonus content of extending it into SQL Server"><meta property="og:type" content="article"><meta name="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://www.kichka.dev/posts/deforestation/"><meta name="twitter:title" content="Deforestation (Logging) - Lost Inspiration"><meta name="twitter:description" content="Logging — The Stack, Fundamentals, and the hard won experience that has continued to pay dividens. With bonus content of extending it into SQL Server"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.13.10"><link rel="icon" href="/favicon/icon.png"><!-- Set the theme before the page is rendered to avoid a flash --><script>(function(){const DEFAULT_THEME = "auto";
const LIGHT_MODE = "light";
const DARK_MODE = "dark";
const AUTO_MODE = "auto";
const BANNER_HEIGHT_EXTEND = 30;
const PAGE_WIDTH = 75;
const configHue = 250;

			// Load the theme from local storage
			const theme = localStorage.getItem('theme') || DEFAULT_THEME;
			switch (theme) {
				case LIGHT_MODE:
					document.documentElement.classList.remove('dark');
					break
				case DARK_MODE:
					document.documentElement.classList.add('dark');
					break
				case AUTO_MODE:
					if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
						document.documentElement.classList.add('dark');
					} else {
						document.documentElement.classList.remove('dark');
					}
			}

			// Load the hue from local storage
			const hue = localStorage.getItem('hue') || configHue;
			document.documentElement.style.setProperty('--hue', hue);

			// calculate the --banner-height-extend, which needs to be a multiple of 4 to avoid blurry text
			let offset = Math.floor(window.innerHeight * (BANNER_HEIGHT_EXTEND / 100));
			offset = offset - offset % 4;
			document.documentElement.style.setProperty('--banner-height-extend', `${offset}px`);
		})();</script><!-- defines global css variables. This will be applied to <html> <body> and some other elements idk why --><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deforestation (Logging)","description":"Logging — The Stack, Fundamentals, and the hard won experience that has continued to pay dividens. With bonus content of extending it into SQL Server","keywords":["logging","sql","dotnet"],"author":{"@type":"Person","name":"Stephen Kichka","url":"https://www.kichka.dev/"},"datePublished":"2025-12-30","inLanguage":"en"}</script><link rel="alternate" type="application/rss+xml" title="Stephen Kichka" href="https://www.kichka.dev/rss.xml"><link rel="stylesheet" href="/_astro/Layout.DSulWsr7.css">
<link rel="stylesheet" href="/_astro/Layout.y4KPJ9hc.css">
<link rel="stylesheet" href="/_astro/_page_.CDKVIqXV.css">
<link rel="stylesheet" href="/_astro/_page_.ZlghMKVQ.css">
<link rel="stylesheet" href="/_astro/about.BtniRLn_.css">
<style>input.svelte-1wah7ro:focus{outline:0}.search-panel.svelte-1wah7ro{max-height:calc(100vh - 100px);overflow-y:auto}#display-setting.svelte-d7tq3k input[type=range]:where(.svelte-d7tq3k){-webkit-appearance:none;height:1.5rem;background-image:var(--color-selection-bar);transition:background-image .15s ease-in-out}#display-setting.svelte-d7tq3k input[type=range]:where(.svelte-d7tq3k)::-webkit-slider-thumb{-webkit-appearance:none;height:1rem;width:.5rem;border-radius:.125rem;background:#ffffffb3;box-shadow:none}#display-setting.svelte-d7tq3k input[type=range]:where(.svelte-d7tq3k)::-webkit-slider-thumb:hover{background:#fffc}#display-setting.svelte-d7tq3k input[type=range]:where(.svelte-d7tq3k)::-webkit-slider-thumb:active{background:#fff9}#display-setting.svelte-d7tq3k input[type=range]:where(.svelte-d7tq3k)::-moz-range-thumb{-webkit-appearance:none;height:1rem;width:.5rem;border-radius:.125rem;border-width:0;background:#ffffffb3;box-shadow:none}#display-setting.svelte-d7tq3k input[type=range]:where(.svelte-d7tq3k)::-moz-range-thumb:hover{background:#fffc}#display-setting.svelte-d7tq3k input[type=range]:where(.svelte-d7tq3k)::-moz-range-thumb:active{background:#fff9}#display-setting.svelte-d7tq3k input[type=range]:where(.svelte-d7tq3k)::-ms-thumb{-webkit-appearance:none;height:1rem;width:.5rem;border-radius:.125rem;background:#ffffffb3;box-shadow:none}#display-setting.svelte-d7tq3k input[type=range]:where(.svelte-d7tq3k)::-ms-thumb:hover{background:#fffc}#display-setting.svelte-d7tq3k input[type=range]:where(.svelte-d7tq3k)::-ms-thumb:active{background:#fff9}
</style><script type="module" src="/_astro/page.Z8IJTFqj.js"></script></head> <body class=" min-h-screen transition " data-overlayscrollbars-initialize data-astro-cid-sckkx6r4 style="--bannerOffset: 15vh;--banner-height-home: 65vh;--banner-height: 35vh;--configHue: 250;--page-width: 75rem;"> <div id="config-carrier" data-hue="250"></div>    <div id="top-row" class="z-50 pointer-events-none relative transition-all duration-700 max-w-[var(--page-width)] px-0 md:px-4 mx-auto"> <div id="navbar-wrapper" class="pointer-events-auto sticky top-0 transition-all"> <div id="navbar" class="z-50 onload-animation"> <div class="absolute h-8 left-0 right-0 -top-8 bg-[var(--card-bg)] transition"></div> <!-- used for onload animation --> <div class="card-base !overflow-visible max-w-[var(--page-width)] h-[4.5rem] !rounded-t-none mx-auto flex items-center justify-between px-4"> <a href="/" class="btn-plain scale-animation rounded-lg h-[3.25rem] px-5 font-bold active:scale-95"> <div class="flex flex-row text-[var(--primary)] items-center text-md"> <svg width="1em" height="1em" class="text-[1.75rem]" data-icon="material-symbols:home-outline-rounded">   <symbol id="ai:material-symbols:home-outline-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M6 19h3v-5q0-.425.288-.712T10 13h4q.425 0 .713.288T15 14v5h3v-9l-6-4.5L6 10zm-2 0v-9q0-.475.213-.9t.587-.7l6-4.5q.525-.4 1.2-.4t1.2.4l6 4.5q.375.275.588.7T20 10v9q0 .825-.588 1.413T18 21h-4q-.425 0-.712-.288T13 20v-5h-2v5q0 .425-.288.713T10 21H6q-.825 0-1.412-.587T4 19m8-6.75"/></symbol><use href="#ai:material-symbols:home-outline-rounded"></use>  </svg> </div> </a> <div class="hidden md:flex">  </div> <div class="flex"> <!--<SearchPanel client:load>--> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z2uGuWM" component-url="/_astro/Search.BKCXF8gJ.js" component-export="default" renderer-url="/_astro/client.svelte.BtEbdPyR.js" props="{}" ssr client="only" opts="{&quot;name&quot;:&quot;Search&quot;,&quot;value&quot;:&quot;svelte&quot;}"></astro-island>  <astro-island uid="Z22HyMX" component-url="/_astro/LightDarkSwitch.Dvjcmsyp.js" component-export="default" renderer-url="/_astro/client.svelte.BtEbdPyR.js" props="{}" ssr client="only" opts="{&quot;name&quot;:&quot;LightDarkSwitch&quot;,&quot;value&quot;:&quot;svelte&quot;}"></astro-island> <!-- <button aria-label="Menu" name="Nav Menu" class="btn-plain scale-animation rounded-lg w-11 h-11 active:scale-90 md:!hidden" id="nav-menu-switch"> --> <!--     <Icon name="material-symbols:menu-rounded" class="text-[1.25rem]"></Icon> --> <!-- </button> --> </div> <!-- <NavMenuPanel links={links}></NavMenuPanel> --> <astro-island uid="23tHHo" component-url="/_astro/DisplaySettings.CtZnC7g8.js" component-export="default" renderer-url="/_astro/client.svelte.BtEbdPyR.js" props="{}" ssr client="only" opts="{&quot;name&quot;:&quot;DisplaySettings&quot;,&quot;value&quot;:&quot;svelte&quot;}"></astro-island> </div> </div> <script type="module">function c(){localStorage.theme==="dark"?(document.documentElement.classList.remove("dark"),localStorage.theme="light"):(document.documentElement.classList.add("dark"),localStorage.theme="dark")}function o(){let t=document.getElementById("scheme-switch");t&&(t.onclick=function(){c()});let n=document.getElementById("display-settings-switch");n&&(n.onclick=function(){let e=document.getElementById("display-setting");e&&e.classList.toggle("float-panel-closed")});let l=document.getElementById("nav-menu-switch");l&&(l.onclick=function(){let e=document.getElementById("nav-menu-panel");e&&e.classList.toggle("float-panel-closed")})}o();</script> <script>(function(){const scriptUrl = "/pagefind/pagefind.js";

async function loadPagefind() {
    try {
        const response = await fetch(scriptUrl, { method: 'HEAD' });
        if (!response.ok) {
            throw new Error(`Pagefind script not found: ${response.status}`);
        }

        const pagefind = await import(scriptUrl);

        await pagefind.options({
            excerptLength: 20
        });

        window.pagefind = pagefind;

        document.dispatchEvent(new CustomEvent('pagefindready'));
        console.log('Pagefind loaded and initialized successfully, event dispatched.');
    } catch (error) {
        console.error('Failed to load Pagefind:', error);
        window.pagefind = {
            search: () => Promise.resolve({ results: [] }),
            options: () => Promise.resolve(),
        };
        document.dispatchEvent(new CustomEvent('pagefindloaderror'));
        console.log('Pagefind load error, event dispatched.');
    }
}

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadPagefind);
} else {
    loadPagefind();
}
})();</script> </div> </div>   <div class="absolute w-full z-30 pointer-events-none" style="top: 5.5rem"> <!-- The pointer-events-none here prevent blocking the click event of the TOC --> <div class="relative max-w-[var(--page-width)] mx-auto pointer-events-auto"> <div id="main-grid" class="transition duration-700 w-full left-0 right-0 grid grid-cols-[17.5rem_auto] grid-rows-[auto_1fr_auto] lg:grid-rows-[auto]
    mx-auto gap-4 px-0 md:px-4"> <!-- Banner image credit -->  <div id="sidebar" class="mb-4 row-start-2 row-end-3 col-span-2 lg:row-start-1 lg:row-end-2 lg:col-span-1 lg:max-w-[17.5rem] onload-animation w-full"> <div class="flex flex-col w-full gap-4 mb-4"> <div class="card-base p-3"> <a aria-label="Go to About Page" href="/about/" class="group block relative mx-auto mt-1 lg:mx-0 lg:mt-0 mb-3
       max-w-[12rem] lg:max-w-none overflow-hidden rounded-xl active:scale-95"> <div class="absolute transition pointer-events-none group-hover:bg-black/30 group-active:bg-black/50
        w-full h-full z-50 flex items-center justify-center"> <svg width="1.13em" height="1em" class="transition opacity-0 scale-90 group-hover:scale-100 group-hover:opacity-100 text-white text-5xl" data-icon="fa6-regular:address-card">   <symbol id="ai:fa6-regular:address-card" viewBox="0 0 576 512"><path fill="currentColor" d="M512 80c8.8 0 16 7.2 16 16v320c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V96c0-8.8 7.2-16 16-16zM64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64zm144 224a64 64 0 1 0 0-128a64 64 0 1 0 0 128m-32 32c-44.2 0-80 35.8-80 80c0 8.8 7.2 16 16 16h192c8.8 0 16-7.2 16-16c0-44.2-35.8-80-80-80zm200-144c-13.3 0-24 10.7-24 24s10.7 24 24 24h80c13.3 0 24-10.7 24-24s-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24h80c13.3 0 24-10.7 24-24s-10.7-24-24-24z"/></symbol><use href="#ai:fa6-regular:address-card"></use>  </svg> </div> <div class="mx-auto lg:w-full h-full lg:mt-0  overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 bg-opacity-50 pointer-events-none"></div> <img src="/_astro/avatar.dq3xf-W5_Z1zJcaH.webp" alt="Profile Image of the Author" style="object-position: center" loading="lazy" decoding="async" fetchpriority="auto" width="1024" height="1024" class="w-full h-full object-cover">  </div> </a> <div class="px-2"> <div class="font-bold text-xl text-center mb-1 dark:text-neutral-50 transition">Stephen Kichka</div> <div class="h-1 w-5 bg-[var(--primary)] mx-auto rounded-full mb-2 transition"></div> <div class="text-center text-neutral-400 mb-2.5 transition">A journey of inspiration lost and found</div> <div class="flex flex-wrap gap-2 justify-center mb-1"> <a rel="me" aria-label href="https://github.com/lostinspiration" target="_blank" class="btn-regular rounded-lg h-10 w-10 active:scale-90"> <svg width="0.97em" height="1em" class="text-[1.5rem]" data-icon="fa6-brands:github">   <symbol id="ai:fa6-brands:github" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6c-3.3.3-5.6-1.3-5.6-3.6c0-2 2.3-3.6 5.2-3.6c3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9c2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9c.3 2 2.9 3.3 5.9 2.6c2.9-.7 4.9-2.6 4.6-4.6c-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2c12.8 2.3 17.3-5.6 17.3-12.1c0-6.2-.3-40.4-.3-61.4c0 0-70 15-84.7-29.8c0 0-11.4-29.1-27.8-36.6c0 0-22.9-15.7 1.6-15.4c0 0 24.9 2 38.6 25.8c21.9 38.6 58.6 27.5 72.9 20.9c2.3-16 8.8-27.1 16-33.7c-55.9-6.2-112.3-14.3-112.3-110.5c0-27.5 7.6-41.3 23.6-58.9c-2.6-6.5-11.1-33.3 2.6-67.9c20.9-6.5 69 27 69 27c20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27c13.7 34.7 5.2 61.4 2.6 67.9c16 17.7 25.8 31.5 25.8 58.9c0 96.5-58.9 104.2-114.8 110.5c9.2 7.9 17 22.9 17 46.4c0 33.7-.3 75.4-.3 83.6c0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252C496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2c1.6 1.6 3.9 2.3 5.2 1c1.3-1 1-3.3-.7-5.2c-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9c1.6 1 3.6.7 4.3-.7c.7-1.3-.3-2.9-2.3-3.9c-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2c2.3 2.3 5.2 2.6 6.5 1c1.3-1.3.7-4.3-1.3-6.2c-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2c-1.4-2.3-4-3.3-5.6-2"/></symbol><use href="#ai:fa6-brands:github"></use>  </svg> </a><a rel="me" aria-label href="https://linkedin.com/in/stephen-kichka" target="_blank" class="btn-regular rounded-lg h-10 w-10 active:scale-90"> <svg width="0.88em" height="1em" class="text-[1.5rem]" data-icon="fa6-brands:linkedin">   <symbol id="ai:fa6-brands:linkedin" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9z"/></symbol><use href="#ai:fa6-brands:linkedin"></use>  </svg> </a><a rel="me" aria-label href="mailto:skichka+blog@gmail.com" target="_blank" class="btn-regular rounded-lg h-10 w-10 active:scale-90"> <svg width="1em" height="1em" class="text-[1.5rem]" data-icon="material-symbols:contact-mail">   <symbol id="ai:material-symbols:contact-mail" viewBox="0 0 24 24"><path fill="currentColor" d="M14 11h7V6h-7zm3.5-1.25L15 8V7l2.5 1.75L20 7v1zM2 21q-.825 0-1.412-.587T0 19V5q0-.825.588-1.412T2 3h20q.825 0 1.413.588T24 5v14q0 .825-.587 1.413T22 21zm7-7q1.25 0 2.125-.875T12 11t-.875-2.125T9 8t-2.125.875T6 11t.875 2.125T9 14m-6.9 5h13.8q-1.05-1.875-2.9-2.937T9 15t-4 1.063T2.1 19"/></symbol><use href="#ai:material-symbols:contact-mail"></use>  </svg> </a>  </div> </div> </div> </div> <div id="sidebar-sticky" class="transition-all duration-700 flex flex-col w-full gap-4 top-4 sticky top-4"> <widget-layout data-id="categories" data-is-collapsed="false" class="pb-4 card-base onload-animation" style="animation-delay: 150ms; --collapsedHeight: 7.5rem;" data-astro-cid-ucso7hve="true"> <div class="font-bold transition text-lg text-neutral-900 dark:text-neutral-100 relative ml-8 mt-4 mb-2
        before:w-1 before:h-4 before:rounded-md before:bg-[var(--primary)]
        before:absolute before:left-[-16px] before:top-[5.5px]" data-astro-cid-ucso7hve style="--collapsedHeight: 7.5rem;">Categories</div> <div id="categories" class="collapse-wrapper px-4 overflow-hidden" data-astro-cid-ucso7hve style="--collapsedHeight: 7.5rem;"> <a href="/archive/?category=Knowledge%20Base" aria-label="View all posts in the Knowledge Base category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-[var(--btn-plain-bg-hover)]
            active:bg-[var(--btn-plain-bg-active)]
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-[var(--primary)]
            dark:text-neutral-300
            dark:hover:text-[var(--primary)]
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap overflow-ellipsis  "> Knowledge Base </div> <div class="transition px-2 h-7 ml-4 min-w-[2rem] rounded-lg text-sm font-bold
                    text-[var(--btn-content)] dark:text-[var(--deep-text)]
                    bg-[var(--btn-regular-bg)] dark:bg-[var(--primary)]
                    flex items-center justify-center"> 5 </div> </div> </button> </a><a href="/archive/?category=Thoughts" aria-label="View all posts in the Thoughts category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-[var(--btn-plain-bg-hover)]
            active:bg-[var(--btn-plain-bg-active)]
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-[var(--primary)]
            dark:text-neutral-300
            dark:hover:text-[var(--primary)]
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap overflow-ellipsis  "> Thoughts </div> <div class="transition px-2 h-7 ml-4 min-w-[2rem] rounded-lg text-sm font-bold
                    text-[var(--btn-content)] dark:text-[var(--deep-text)]
                    bg-[var(--btn-regular-bg)] dark:bg-[var(--primary)]
                    flex items-center justify-center"> 2 </div> </div> </button> </a> </div>  </widget-layout>  <script type="module">class d extends HTMLElement{constructor(){if(super(),this.dataset.isCollapsed!=="true")return;const e=this.dataset.id,t=this.querySelector(".expand-btn"),s=this.querySelector(`#${e}`);t.addEventListener("click",()=>{s.classList.remove("collapsed"),t.classList.add("hidden")})}}customElements.get("widget-layout")||customElements.define("widget-layout",d);</script> <widget-layout data-id="tags" data-is-collapsed="false" class="pb-4 card-base onload-animation" style="animation-delay: 200ms; --collapsedHeight: 7.5rem;" data-astro-cid-ucso7hve="true"> <div class="font-bold transition text-lg text-neutral-900 dark:text-neutral-100 relative ml-8 mt-4 mb-2
        before:w-1 before:h-4 before:rounded-md before:bg-[var(--primary)]
        before:absolute before:left-[-16px] before:top-[5.5px]" data-astro-cid-ucso7hve style="--collapsedHeight: 7.5rem;">Tags</div> <div id="tags" class="collapse-wrapper px-4 overflow-hidden" data-astro-cid-ucso7hve style="--collapsedHeight: 7.5rem;">  <div class="flex gap-2 flex-wrap"> <a href="/archive/?tag=dotnet" aria-label="View all posts with the dotnet tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  dotnet </a><a href="/archive/?tag=logging" aria-label="View all posts with the logging tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  logging </a><a href="/archive/?tag=sql" aria-label="View all posts with the sql tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  sql </a> </div>  </div>  </widget-layout>   </div> </div> <main id="swup-container" class="transition-swup-fade col-span-2 lg:col-span-1 overflow-hidden"> <div id="content-wrapper" class="onload-animation"> <!-- the overflow-hidden here prevent long text break the layout--> <!-- make id different from windows.swup global property -->   <div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative mb-4"> <div id="post-container" class="card-base z-10 px-6 md:px-9 pt-6 pb-4 relative w-full "> <!-- word count and reading time --> <div class="flex flex-row text-black/30 dark:text-white/30 gap-5 mb-3 transition onload-animation"> <div class="flex flex-row items-center"> <div class="transition h-6 w-6 rounded-md bg-black/5 dark:bg-white/10 text-black/50 dark:text-white/50 flex items-center justify-center mr-2"> <svg width="1em" height="1em" data-icon="material-symbols:notes-rounded">   <symbol id="ai:material-symbols:notes-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h10q.425 0 .713.288T15 17t-.288.713T14 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z"/></symbol><use href="#ai:material-symbols:notes-rounded"></use>  </svg> </div> <div class="text-sm">1896  words</div> </div> <div class="flex flex-row items-center"> <div class="transition h-6 w-6 rounded-md bg-black/5 dark:bg-white/10 text-black/50 dark:text-white/50 flex items-center justify-center mr-2"> <svg width="1em" height="1em" data-icon="material-symbols:schedule-outline-rounded">   <symbol id="ai:material-symbols:schedule-outline-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M13 11.6V8q0-.425-.288-.712T12 7t-.712.288T11 8v3.975q0 .2.075.388t.225.337l3.3 3.3q.275.275.7.275T16 16t.275-.7t-.275-.7zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.325 0 5.663-2.337T20 12t-2.337-5.663T12 4T6.337 6.338T4 12t2.338 5.663T12 20"/></symbol><use href="#ai:material-symbols:schedule-outline-rounded"></use>  </svg> </div> <div class="text-sm"> 9  minutes </div> </div> </div> <!-- title --> <div class="relative onload-animation"> <div data-pagefind-body data-pagefind-weight="10" data-pagefind-meta="title" class="transition w-full block font-bold mb-3
                    text-3xl md:text-[2.25rem]/[2.75rem]
                    text-black/90 dark:text-white/90
                    md:before:w-1 before:h-5 before:rounded-md before:bg-[var(--primary)]
                    before:absolute before:top-[0.75rem] before:left-[-1.125rem]
                "> Deforestation (Logging) </div> </div> <!-- metadata --> <div class="onload-animation"> <div class="flex flex-wrap text-neutral-500 dark:text-neutral-400 items-center gap-4 gap-x-4 gap-y-2 mb-5"> <!-- publish date --> <div class="flex items-center"> <div class="meta-icon"> <svg width="1em" height="1em" class="text-xl" data-icon="material-symbols:calendar-today-outline-rounded">   <symbol id="ai:material-symbols:calendar-today-outline-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M5 22q-.825 0-1.412-.587T3 20V6q0-.825.588-1.412T5 4h1V3q0-.425.288-.712T7 2t.713.288T8 3v1h8V3q0-.425.288-.712T17 2t.713.288T18 3v1h1q.825 0 1.413.588T21 6v14q0 .825-.587 1.413T19 22zm0-2h14V10H5zM5 8h14V6H5zm0 0V6z"/></symbol><use href="#ai:material-symbols:calendar-today-outline-rounded"></use>  </svg> </div> <span class="text-50 text-sm font-medium">2025-12-30</span> </div> <!-- update date -->  <!-- categories --> <div class="flex items-center"> <div class="meta-icon"> <svg width="1em" height="1em" class="text-xl" data-icon="material-symbols:book-2-outline-rounded">   <symbol id="ai:material-symbols:book-2-outline-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M6 15.325q.35-.175.725-.25T7.5 15H8V4h-.5q-.625 0-1.062.438T6 5.5zM10 15h8V4h-8zm-4 .325V4zM7.5 22q-1.45 0-2.475-1.025T4 18.5v-13q0-1.45 1.025-2.475T7.5 2H18q.825 0 1.413.587T20 4v12.525q0 .2-.162.363t-.588.362q-.35.175-.55.5t-.2.75t.2.763t.55.487t.55.413t.2.562v.25q0 .425-.288.725T19 22zm0-2h9.325q-.15-.35-.237-.712T16.5 18.5q0-.4.075-.775t.25-.725H7.5q-.65 0-1.075.438T6 18.5q0 .65.425 1.075T7.5 20"/></symbol><use href="#ai:material-symbols:book-2-outline-rounded"></use>  </svg> </div> <div class="flex flex-row flex-nowrap items-center"> <a href="/archive/?category=Thoughts" aria-label="View all posts in the Thoughts category" class="link-lg transition text-50 text-sm font-medium
                            hover:text-[var(--primary)] dark:hover:text-[var(--primary)] whitespace-nowrap"> Thoughts </a> </div> </div> <!-- tags --> <div class="items-center flex"> <div class="meta-icon"> <svg width="1em" height="1em" class="text-xl" data-icon="material-symbols:tag-rounded">   <symbol id="ai:material-symbols:tag-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="m9 16l-.825 3.275q-.075.325-.325.525t-.6.2q-.475 0-.775-.375T6.3 18.8L7 16H4.275q-.5 0-.8-.387T3.3 14.75q.075-.35.35-.55t.625-.2H7.5l1-4H5.775q-.5 0-.8-.387T4.8 8.75q.075-.35.35-.55t.625-.2H9l.825-3.275Q9.9 4.4 10.15 4.2t.6-.2q.475 0 .775.375t.175.825L11 8h4l.825-3.275q.075-.325.325-.525t.6-.2q.475 0 .775.375t.175.825L17 8h2.725q.5 0 .8.387t.175.863q-.075.35-.35.55t-.625.2H16.5l-1 4h2.725q.5 0 .8.388t.175.862q-.075.35-.35.55t-.625.2H15l-.825 3.275q-.075.325-.325.525t-.6.2q-.475 0-.775-.375T12.3 18.8L13 16zm.5-2h4l1-4h-4z"/></symbol><use href="#ai:material-symbols:tag-rounded"></use>  </svg> </div> <div class="flex flex-row flex-nowrap items-center"> <div class="hidden mx-1.5 text-[var(--meta-divider)] text-sm">/</div>
                <a href="/archive/?tag=logging" aria-label="View all posts with the logging tag" class="link-lg transition text-50 text-sm font-medium
                                hover:text-[var(--primary)] dark:hover:text-[var(--primary)] whitespace-nowrap"> logging </a><div class="mx-1.5 text-[var(--meta-divider)] text-sm">/</div>
                <a href="/archive/?tag=sql" aria-label="View all posts with the sql tag" class="link-lg transition text-50 text-sm font-medium
                                hover:text-[var(--primary)] dark:hover:text-[var(--primary)] whitespace-nowrap"> sql </a><div class="mx-1.5 text-[var(--meta-divider)] text-sm">/</div>
                <a href="/archive/?tag=dotnet" aria-label="View all posts with the dotnet tag" class="link-lg transition text-50 text-sm font-medium
                                hover:text-[var(--primary)] dark:hover:text-[var(--primary)] whitespace-nowrap"> dotnet </a>  </div> </div> </div> <div class="border-[var(--line-divider)] border-dashed border-b-[1px] mb-5"></div> </div> <!-- always show cover as long as it has one -->  <div data-pagefind-body class="prose dark:prose-invert prose-base !max-w-none custom-md mb-6 markdown-content onload-animation"> <!--<div class="prose dark:prose-invert max-w-none custom-md">--> <!--<div class="max-w-none custom-md">-->  <p>Nothing is more frustrating than a system being broken with no visibility into it, at the same time there is nothing more satisfying than catching problems with your vendors before they do. Being proactive, rather than reactive also buys a ton of grace from your users when you catch problems before they are reported and sometime having gone totally unnoticed.</p>
<p>This reminds me of a quote from the <a href="https://www.imdb.com/title/tt0756880/" target="_blank">Futurama Godfellas</a> episode where the Galaxy God Entity is talking to Bender and says <em>“When you do things right, people won’t be sure you’ve done anything at all”</em> and I couldn’t agree more. Proper logging and visibility will lead to exactly that!</p>
<p>Below we will look at how I have implemented it and the choices made along the way.</p>
<section><h1 id="the-software-stack">The Software Stack<a class="anchor" href="#the-software-stack"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h1><section><h2 id="grafana"><a href="https://grafana.com/oss/grafana/?pg=get&#x26;plcmt=selfmanaged-box1-cta2" target="_blank">Grafana</a><a class="anchor" href="#grafana"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>This is the user interface to query logs and metrics, creating rich dashboards and visualizations, and alerting when specific conditions are met.</p></section><section><h2 id="loki"><a href="https://grafana.com/oss/loki/?pg=get&#x26;plcmt=selfmanaged-box2-cta2" target="_blank">Loki</a><a class="anchor" href="#loki"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>This is a platform specifically optimized for handling message streams. I prefer to instrument my applications using JSON messages that Grafana can then parse out with <a href="https://grafana.com/docs/loki/latest/query/log_queries/" target="_blank">LogQL</a>. Become familiar with writing log queries as that is how you will explore the data.</p><p>Log streams are grouped by labels. These labels have served me quite well for many years.</p><ul>
<li><strong>Application</strong> is the top level assembly or application that produced the log</li>
<li><strong>Environment</strong> is the environment <em>(e.g. dev, stage, production)</em></li>
<li><strong>MachineName</strong> is the computer or server running the application</li>
</ul><blockquote class="admonition bdm-warning"><span class="bdm-title">WARNING</span><p>Loki will group and store in like chunks (files) on the server using the stream labels. You want this to be as <strong>low cardinality</strong> as possible to avoid having too many individual files on the server.</p></blockquote><p>You might be asking at this point, “How do I add additional information to my log messages”? This is where the Log Property Stack comes in. It is a way to enrich your logs with additional context without trying to jam it into the log message itself.</p><section><h4 id="log-property-stack">Log Property Stack<a class="anchor" href="#log-property-stack"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4><p>Instead of adding all the details to the log message itself, you should utilize the property stack which will persist the property with every message nested within the scope that property was defined.</p><p>Here are some examples of what I use through my applications. These are staples that I include in everything and add more as needed to determine application state at major branching points.</p><ul>
<li><strong>InstanceId</strong> for long running process, defering to CorrelationId for nested units of work</li>
<li><strong>CorrelationId</strong> for discrete units of work</li>
<li><strong>RequestInfo</strong> object for web stuff like url, headers, query params, and other information to help trace requests.</li>
</ul></section><section><h4 id="dependency-recommendations">Dependency Recommendations<a class="anchor" href="#dependency-recommendations"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4><ul>
<li><strong>Serilog</strong> for dotnet applications</li>
<li><strong>Serilog.Sinks.Debug</strong> for web applications when you are running locally</li>
<li><strong>Serilog.Sinks.Console</strong> for console applications writing to stdout/stderr</li>
<li><strong>Serilog.Sinks.Grafana.Loki</strong> for writing to a Loki server</li>
<li><strong>SerilogTimings</strong> for timing operations, use this whenever my application leaves its domain of control <em>(e.g. when making database query or web requests)</em></li>
<li><strong>Custom stored procedures</strong> for SQL Server, <em>see <a href="#bonus">bonus content</a> below</em></li>
</ul></section></section><section><h2 id="prometheus"><a href="https://grafana.com/oss/prometheus/?pg=get&#x26;plcmt=selfmanaged-box11-cta2" target="_blank">Prometheus</a><a class="anchor" href="#prometheus"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>Prometheus is a time series database and handles things that do not fit into structured logging such as performance counters. Like Loki, has its own query language called <a href="https://prometheus.io/docs/prometheus/latest/querying/basics/" target="_blank">PromQL</a>.</p><section><h4 id="performance-counters">Performance counters<a class="anchor" href="#performance-counters"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4><ul>
<li>CPU and Memory Utilization</li>
<li>Disk and Network Usage</li>
<li>IIS and SQL specific counters like request throughput</li>
</ul><p>These counters can be gathered from the servers directly using a tool called <a href="https://github.com/prometheus-community/windows_exporter" target="_blank">windows_exporter</a> that provides an HTTP endpoint that can be scraped by a Prometheus server.</p><blockquote class="admonition bdm-warning"><span class="bdm-title">WARNING</span><p>Please be mindful of your companies security practices as the out of the box the server is not secured. Configuration can be found <a href="https://github.com/prometheus/exporter-toolkit/blob/master/docs/web-configuration.md" target="_blank">here</a>.</p></blockquote></section></section></section>
<section><h1 id="logging-fundamentals">Logging Fundamentals<a class="anchor" href="#logging-fundamentals"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h1><blockquote class="admonition bdm-caution"><span class="bdm-title"><div>Here be dragons…</div></span><ul>
<li>Avoid logging PII — Logs are public and can leak information</li>
<li>Avoid excessive logging — Logging can be great at first to build confidence in a process. If you find yourself logging every little step, <code>Debug</code> or <code>Verbose</code> should be used</li>
<li>Avoid logging user correctable errors as <code>Error</code>. <code>Debug</code> or <code>Warning</code> may be a more appropriate place for these types of messages</li>
<li>Avoid punctuation when possible. Log messages are <strong>fragments, not sentences</strong></li>
</ul></blockquote><section><h2 id="log-key-events">Log Key Events<a class="anchor" href="#log-key-events"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><ul>
<li>Major branching points in your code</li>
<li>When errors or unexpected values are encountered</li>
<li>Any IO or resource intensive operations</li>
<li>Significant domain events</li>
<li>Request failures and retires</li>
<li>Beginning and end of time-consuming batch operations</li>
</ul></section><section><h2 id="choose-appropriate-logging-level">Choose Appropriate Logging Level<a class="anchor" href="#choose-appropriate-logging-level"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><ul>
<li>Be generous with your logging but strict with your logging levels. In almost all cases the level of your logs should be Debug</li>
<li>Use Information for log events that would be needed in production to determine the running state or correctness of your application</li>
<li>Use Warning or Error for unexpected events like exceptions</li>
<li>The Error level should be reserved for events that you intend to act on. User correctable errors should never be logged at this level</li>
</ul></section></section>
<section><h1 id="bonus--logging-in-sql-server">Bonus — Logging in SQL Server<a class="anchor" href="#bonus--logging-in-sql-server"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h1><section><h2 id="configure">Configure<a class="anchor" href="#configure"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>This is called at the start of your SQL session that you want to log and should only be called once per session.</p><div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.4fsv9.css"><script type="module" src="/_astro/ec.g1fg5.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">CREATE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">PROCEDURE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [dbo].[ConfigureFor](</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@Application </span><span style="--0:#F97583;--1:#F97583">VARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">200</span><span style="--0:#E1E4E8;--1:#E1E4E8">),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@Environment </span><span style="--0:#F97583;--1:#F97583">VARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">11</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">AS</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">BEGIN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">TRY</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- normalize and validate environment value</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Environment </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">CASE</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">WHEN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Environment </span><span style="--0:#F97583;--1:#F97583">IN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span><span style="--0:#9ECBFF;--1:#9ECBFF">'development'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#9ECBFF;--1:#9ECBFF">'0'</span><span style="--0:#E1E4E8;--1:#E1E4E8">) </span><span style="--0:#F97583;--1:#F97583">THEN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">'Development'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">WHEN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Environment </span><span style="--0:#F97583;--1:#F97583">IN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span><span style="--0:#9ECBFF;--1:#9ECBFF">'stage'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#9ECBFF;--1:#9ECBFF">'2'</span><span style="--0:#E1E4E8;--1:#E1E4E8">) </span><span style="--0:#F97583;--1:#F97583">THEN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">'Stage'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">WHEN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Environment </span><span style="--0:#F97583;--1:#F97583">IN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span><span style="--0:#9ECBFF;--1:#9ECBFF">'production'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#9ECBFF;--1:#9ECBFF">'1'</span><span style="--0:#E1E4E8;--1:#E1E4E8">) </span><span style="--0:#F97583;--1:#F97583">THEN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">'Production'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">ELSE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">END</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">IF</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Environment </span><span style="--0:#F97583;--1:#F97583">IS</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">RAISERROR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#9ECBFF;--1:#9ECBFF">'Invalid environment value. Should be one of [Development|Stage|Production]'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#79B8FF;--1:#79B8FF">16</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#79B8FF;--1:#79B8FF">1</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">END</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">DECLARE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @ReadOnly </span><span style="--0:#F97583;--1:#F97583">INT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">1</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> sp_set_session_context </span><span style="--0:#9ECBFF;--1:#9ECBFF">'Application'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, @Application, @ReadOnly</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> sp_set_session_context </span><span style="--0:#9ECBFF;--1:#9ECBFF">'MachineName'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, @@SERVERNAME, @ReadOnly</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> sp_set_session_context </span><span style="--0:#9ECBFF;--1:#9ECBFF">'Environment'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, @Environment, @ReadOnly</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> sp_set_session_context </span><span style="--0:#9ECBFF;--1:#9ECBFF">'__index__'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#F97583;--1:#F97583">NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">END</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">TRY</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">BEGIN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">CATCH</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">THROW</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">END</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">CATCH</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">END</span></div></div></code><button class="copy-btn" aria-label="Copy code"><div class="copy-btn-icon"><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon copy-icon"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon success-icon"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div></button></pre></figure></div></section><section><h2 id="log-level-functions">Log Level Functions<a class="anchor" href="#log-level-functions"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>The meat and potatoes of the implementation. It will gather all of the log properties off the stack and do the submission to the Loki server. There are convenience functions for each log level.</p><section><h3 id="implementation">Implementation<a class="anchor" href="#implementation"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><blockquote class="admonition bdm-important"><span class="bdm-title">IMPORTANT</span><p>This will need a way to make HTTP requests from SQL Server. This could be through <a href="https://learn.microsoft.com/en-us/sql/database-engine/configure-windows/ole-automation-procedures-server-configuration-option" target="_blank">OLEAutomation</a>, a dotnet SQLCLR assembly or SQL Server Language Extensions.</p></blockquote><blockquote class="admonition bdm-note"><span class="bdm-title">NOTE</span><p>This is typically not called directly favoring the convenience functions.</p></blockquote><div class="expressive-code"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">CREATE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">PROCEDURE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [dbo].[LogTo_Impl](</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@Message </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">4000</span><span style="--0:#E1E4E8;--1:#E1E4E8">),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@Level </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">50</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">AS</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">BEGIN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">TRY</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--DECLARE @Message NVARCHAR(4000) = 'DONKEY!'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- cheap insurance to make sure that ConfigureFor has been called</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">IF</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">SESSION_CONTEXT</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#9ECBFF;--1:#9ECBFF">N'Application'</span><span style="--0:#E1E4E8;--1:#E1E4E8">) </span><span style="--0:#F97583;--1:#F97583">IS</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">RETURN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">END</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- get log time as unix epoch in nanos</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">DECLARE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Time </span><span style="--0:#F97583;--1:#F97583">BIGINT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> DATEDIFF_BIG(</span><span style="--0:#F97583;--1:#F97583">NANOSECOND</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#9ECBFF;--1:#9ECBFF">'1970-01-01 00:00:00.0000000'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#79B8FF;--1:#79B8FF">SYSUTCDATETIME</span><span style="--0:#E1E4E8;--1:#E1E4E8">())</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- add standard set of properties to be logged</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogProperty_Add </span><span style="--0:#9ECBFF;--1:#9ECBFF">'Message'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, @Message</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogProperty_Add </span><span style="--0:#9ECBFF;--1:#9ECBFF">'level'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, @Level</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- send to loki</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- json</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--   "streams": [</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--   {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--     "stream": {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--       "label": "value"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--     },</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--     "values": [</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--       [ "unix epoch in nanoseconds", "log line" ],</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--       [ "unix epoch in nanoseconds", "log line" ]</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--     ]</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--   }</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--   ]</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- }</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- http://localhost:3100/loki/api/v1/push</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- these are configured in the ConfigureFor stored procedure</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">DECLARE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @StreamLabels </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(MAX) </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">FROM</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#F97583">FROM</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#F97583;--1:#F97583">VALUES</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#9ECBFF;--1:#9ECBFF">'Application'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#79B8FF;--1:#79B8FF">SESSION_CONTEXT</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#9ECBFF;--1:#9ECBFF">N'Application'</span><span style="--0:#E1E4E8;--1:#E1E4E8">)),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#9ECBFF;--1:#9ECBFF">'MachineName'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#79B8FF;--1:#79B8FF">SESSION_CONTEXT</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#9ECBFF;--1:#9ECBFF">N'MachineName'</span><span style="--0:#E1E4E8;--1:#E1E4E8">)),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#9ECBFF;--1:#9ECBFF">'Environment'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#79B8FF;--1:#79B8FF">SESSION_CONTEXT</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#9ECBFF;--1:#9ECBFF">N'Environment'</span><span style="--0:#E1E4E8;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">        </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">) stream_labels([key], [value])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">      </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">) a</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">      </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">PIVOT (</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#79B8FF">MAX</span><span style="--0:#E1E4E8;--1:#E1E4E8">([value]) </span><span style="--0:#F97583;--1:#F97583">FOR</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [key] </span><span style="--0:#F97583;--1:#F97583">IN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> ([Application], [MachineName], [Environment])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">      </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">) pvt</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">FOR</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">JSON</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">AUTO</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#F97583;--1:#F97583">WITHOUT_ARRAY_WRAPPER</span><span style="--0:#99A0A6;--1:#99A0A6">/*, INCLUDE_NULL_VALUES*/</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">    </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--SELECT @StreamLabels</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">IF</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">OBJECT_ID</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#9ECBFF;--1:#9ECBFF">'tempdb..#TMP'</span><span style="--0:#E1E4E8;--1:#E1E4E8">) </span><span style="--0:#F97583;--1:#F97583">IS NOT NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">DROP</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">TABLE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> #TMP</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">END</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">SELECT</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">      </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[key] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [value],</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">      </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[value] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">SESSION_CONTEXT</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">CAST</span><span style="--0:#E1E4E8;--1:#E1E4E8">([value] </span><span style="--0:#F97583;--1:#F97583">AS</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">100</span><span style="--0:#E1E4E8;--1:#E1E4E8">))),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">      </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[is_json] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ISJSON</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">CAST</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">SESSION_CONTEXT</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">CAST</span><span style="--0:#E1E4E8;--1:#E1E4E8">([value] </span><span style="--0:#F97583;--1:#F97583">AS</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">100</span><span style="--0:#E1E4E8;--1:#E1E4E8">))) </span><span style="--0:#F97583;--1:#F97583">AS</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(MAX)))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">INTO</span><span style="--0:#E1E4E8;--1:#E1E4E8"> #TMP</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">FROM</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">OPENJSON</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">CAST</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">SESSION_CONTEXT</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#9ECBFF;--1:#9ECBFF">N'__index__'</span><span style="--0:#E1E4E8;--1:#E1E4E8">) </span><span style="--0:#F97583;--1:#F97583">AS</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(MAX)))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- generate select list to account for json column data.</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- we have to use JSON_QUERY on json data so that it is treated as a json fragment when the overall select is serialized</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">DECLARE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @SelectList </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(MAX) </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">STUFF</span><span style="--0:#E1E4E8;--1:#E1E4E8">((</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- stuff select begin</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">','</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">+</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">IIF</span><span style="--0:#E1E4E8;--1:#E1E4E8">([is_json] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">1</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#79B8FF;--1:#79B8FF">QUOTENAME</span><span style="--0:#E1E4E8;--1:#E1E4E8">([key]) </span><span style="--0:#F97583;--1:#F97583">+</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">' = JSON_QUERY(CAST('</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">+</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">QUOTENAME</span><span style="--0:#E1E4E8;--1:#E1E4E8">([key]) </span><span style="--0:#F97583;--1:#F97583">+</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">' AS NVARCHAR(MAX)))'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#79B8FF;--1:#79B8FF">QUOTENAME</span><span style="--0:#E1E4E8;--1:#E1E4E8">([key]))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">FROM</span><span style="--0:#E1E4E8;--1:#E1E4E8"> #TMP</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">FOR</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">XML</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">PATH</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span><span style="--0:#9ECBFF;--1:#9ECBFF">''</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- stuff select end</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">    </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">), </span><span style="--0:#79B8FF;--1:#79B8FF">1</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#79B8FF;--1:#79B8FF">1</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#9ECBFF;--1:#9ECBFF">''</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">    </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--SELECT @SelectList</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- generate pivot list</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">DECLARE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @PvtList </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(MAX) </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">STUFF</span><span style="--0:#E1E4E8;--1:#E1E4E8">((</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- stuff select begin</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">','</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">+</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">QUOTENAME</span><span style="--0:#E1E4E8;--1:#E1E4E8">([key]) </span><span style="--0:#F97583;--1:#F97583">FROM</span><span style="--0:#E1E4E8;--1:#E1E4E8"> #TMP</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">FOR</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">XML</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">PATH</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span><span style="--0:#9ECBFF;--1:#9ECBFF">''</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- stuff select end</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">    </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">), </span><span style="--0:#79B8FF;--1:#79B8FF">1</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#79B8FF;--1:#79B8FF">1</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#9ECBFF;--1:#9ECBFF">''</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">    </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--SELECT @PvtList</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- generate message span</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">DECLARE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Sql </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(MAX) </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">''</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Sql </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#9ECBFF">    </span></span><span style="--0:#9ECBFF;--1:#9ECBFF">DECLARE @Json NVARCHAR(MAX) = (</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#9ECBFF">      </span></span><span style="--0:#9ECBFF;--1:#9ECBFF">SELECT {1}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#9ECBFF">      </span></span><span style="--0:#9ECBFF;--1:#9ECBFF">FROM (</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#9ECBFF">        </span></span><span style="--0:#9ECBFF;--1:#9ECBFF">SELECT [key], [value]</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">99</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#9ECBFF">        </span></span><span style="--0:#9ECBFF;--1:#9ECBFF">FROM #TMP</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">100</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#9ECBFF">      </span></span><span style="--0:#9ECBFF;--1:#9ECBFF">) a</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">101</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#9ECBFF">      </span></span><span style="--0:#9ECBFF;--1:#9ECBFF">PIVOT (</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">102</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#9ECBFF">        </span></span><span style="--0:#9ECBFF;--1:#9ECBFF">MAX([value]) FOR [key] IN ({0})</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">103</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#9ECBFF">      </span></span><span style="--0:#9ECBFF;--1:#9ECBFF">) pvt</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">104</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#9ECBFF">      </span></span><span style="--0:#9ECBFF;--1:#9ECBFF">FOR JSON AUTO, WITHOUT_ARRAY_WRAPPER/*, INCLUDE_NULL_VALUES*/</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">105</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#9ECBFF">    </span></span><span style="--0:#9ECBFF;--1:#9ECBFF">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">106</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#9ECBFF">    </span></span><span style="--0:#9ECBFF;--1:#9ECBFF">SELECT @Json'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">107</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Sql </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">REPLACE</span><span style="--0:#E1E4E8;--1:#E1E4E8">(@Sql, </span><span style="--0:#9ECBFF;--1:#9ECBFF">'{0}'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, @PvtList)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">108</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Sql </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">REPLACE</span><span style="--0:#E1E4E8;--1:#E1E4E8">(@Sql, </span><span style="--0:#9ECBFF;--1:#9ECBFF">'{1}'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, @SelectList)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">109</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">110</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">DECLARE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Json </span><span style="--0:#F97583;--1:#F97583">TABLE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> ([Json] </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(MAX))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">111</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">INSERT INTO</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Json</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">112</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8">(@Sql)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">113</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">114</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- generate full loki request</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">115</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">DECLARE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @LokiRequest </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(MAX) </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">116</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">SELECT</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">117</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">        </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[stream] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">JSON_QUERY</span><span style="--0:#E1E4E8;--1:#E1E4E8">(@StreamLabels),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">118</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">        </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[values] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">JSON_QUERY</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#9ECBFF;--1:#9ECBFF">'[['</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">+</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">QUOTENAME</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">CAST</span><span style="--0:#E1E4E8;--1:#E1E4E8">(@Time </span><span style="--0:#F97583;--1:#F97583">AS</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">VARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">20</span><span style="--0:#E1E4E8;--1:#E1E4E8">)), </span><span style="--0:#9ECBFF;--1:#9ECBFF">'"'</span><span style="--0:#E1E4E8;--1:#E1E4E8">) </span><span style="--0:#F97583;--1:#F97583">+</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">',"'</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">+</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">STRING_ESCAPE</span><span style="--0:#E1E4E8;--1:#E1E4E8">([Json], </span><span style="--0:#9ECBFF;--1:#9ECBFF">'json'</span><span style="--0:#E1E4E8;--1:#E1E4E8">) </span><span style="--0:#F97583;--1:#F97583">+</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">'"]]'</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">119</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">FROM</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Json</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">120</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">FOR</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">JSON</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">AUTO</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#F97583;--1:#F97583">ROOT</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#9ECBFF;--1:#9ECBFF">'streams'</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">121</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">    </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">122</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--SELECT @LokiRequest</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">123</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--PRINT @LokiRequest</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">124</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">125</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- reset exception</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">126</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogProperty_Add </span><span style="--0:#9ECBFF;--1:#9ECBFF">'Exception'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#F97583;--1:#F97583">NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">127</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">128</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- loose the request</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">129</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">DECLARE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @HeadersJson </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(MAX) </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">130</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">131</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">FROM</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">132</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#F97583">SELECT</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">133</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[content-type] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">'application/json'</span><span style="--0:#E1E4E8;--1:#E1E4E8">,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">134</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[content-length] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">CAST</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">LEN</span><span style="--0:#E1E4E8;--1:#E1E4E8">(@LokiRequest) </span><span style="--0:#F97583;--1:#F97583">AS</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">VARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">20</span><span style="--0:#E1E4E8;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">135</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">      </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">) a</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">136</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">FOR</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">JSON</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">AUTO</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">137</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">    </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">138</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--SELECT @HeadersJson</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">139</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">140</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> HttpPost </span><span style="--0:#9ECBFF;--1:#9ECBFF">'http://localhost:3100/loki/api/v1/push'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, @LokiRequest, </span><span style="--0:#F97583;--1:#F97583">NULL</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#F97583;--1:#F97583">NULL</span><span style="--0:#E1E4E8;--1:#E1E4E8">, @HeadersJson</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">141</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">END</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">TRY</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">142</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">BEGIN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">CATCH</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">143</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- swallow</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">144</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">END</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">CATCH</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">145</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">END</span></div></div></code><button class="copy-btn" aria-label="Copy code"><div class="copy-btn-icon"><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon copy-icon"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon success-icon"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div></button></pre></figure></div></section><section><h3 id="fatal">Fatal<a class="anchor" href="#fatal"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">CREATE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">PROCEDURE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [dbo].[LogTo_Fatal](</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@Message </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">4000</span><span style="--0:#E1E4E8;--1:#E1E4E8">),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@CallingProc </span><span style="--0:#F97583;--1:#F97583">SYSNAME</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">AS</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">IF</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @CallingProc </span><span style="--0:#F97583;--1:#F97583">IS NOT NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogProperty_AddSourceContext @CallingProc</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">END</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">  </span><span style="--0:#99A0A6;--1:#99A0A6">-- extra error details</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">IF</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ERROR_MESSAGE</span><span style="--0:#E1E4E8;--1:#E1E4E8">() </span><span style="--0:#F97583;--1:#F97583">IS NOT NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">DECLARE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Exception </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">4000</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Exception </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">FROM</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#F97583">SELECT</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[ErrorNumber] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ERROR_NUMBER</span><span style="--0:#E1E4E8;--1:#E1E4E8">(),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[ErrorSeverity] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ERROR_SEVERITY</span><span style="--0:#E1E4E8;--1:#E1E4E8">(),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[ErrorState] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ERROR_STATE</span><span style="--0:#E1E4E8;--1:#E1E4E8">(),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[ErrorProcedure] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ERROR_PROCEDURE</span><span style="--0:#E1E4E8;--1:#E1E4E8">(),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[ErrorLine] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ERROR_LINE</span><span style="--0:#E1E4E8;--1:#E1E4E8">(),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[ErrorMessage] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ERROR_MESSAGE</span><span style="--0:#E1E4E8;--1:#E1E4E8">()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">      </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">) exception</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">FOR</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">JSON</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">AUTO</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#F97583;--1:#F97583">WITHOUT_ARRAY_WRAPPER</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">    </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogProperty_Add </span><span style="--0:#9ECBFF;--1:#9ECBFF">'Exception'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, @Exception</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">END</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogTo_Impl @Message, </span><span style="--0:#9ECBFF;--1:#9ECBFF">'critical'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">END</span></div></div></code><button class="copy-btn" aria-label="Copy code"><div class="copy-btn-icon"><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon copy-icon"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon success-icon"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div></button></pre></figure></div></section><section><h3 id="error">Error<a class="anchor" href="#error"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">CREATE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">PROCEDURE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [dbo].[LogTo_Error](</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@Message </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">4000</span><span style="--0:#E1E4E8;--1:#E1E4E8">),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@CallingProc </span><span style="--0:#F97583;--1:#F97583">SYSNAME</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">AS</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">IF</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @CallingProc </span><span style="--0:#F97583;--1:#F97583">IS NOT NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogProperty_AddSourceContext @CallingProc</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">END</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">  </span><span style="--0:#99A0A6;--1:#99A0A6">-- extra error details</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">IF</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ERROR_MESSAGE</span><span style="--0:#E1E4E8;--1:#E1E4E8">() </span><span style="--0:#F97583;--1:#F97583">IS NOT NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">DECLARE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Exception </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">4000</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Exception </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">FROM</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#F97583">SELECT</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[ErrorNumber] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ERROR_NUMBER</span><span style="--0:#E1E4E8;--1:#E1E4E8">(),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[ErrorSeverity] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ERROR_SEVERITY</span><span style="--0:#E1E4E8;--1:#E1E4E8">(),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[ErrorState] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ERROR_STATE</span><span style="--0:#E1E4E8;--1:#E1E4E8">(),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[ErrorProcedure] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ERROR_PROCEDURE</span><span style="--0:#E1E4E8;--1:#E1E4E8">(),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[ErrorLine] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ERROR_LINE</span><span style="--0:#E1E4E8;--1:#E1E4E8">(),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">          </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">[ErrorMessage] </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ERROR_MESSAGE</span><span style="--0:#E1E4E8;--1:#E1E4E8">()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">      </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">) exception</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#F97583">FOR</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">JSON</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">AUTO</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#F97583;--1:#F97583">WITHOUT_ARRAY_WRAPPER</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">    </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogProperty_Add </span><span style="--0:#9ECBFF;--1:#9ECBFF">'Exception'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, @Exception</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">END</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogTo_Impl @Message, </span><span style="--0:#9ECBFF;--1:#9ECBFF">'error'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">END</span></div></div></code><button class="copy-btn" aria-label="Copy code"><div class="copy-btn-icon"><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon copy-icon"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon success-icon"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div></button></pre></figure></div></section><section><h3 id="debug">Debug<a class="anchor" href="#debug"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">CREATE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">PROCEDURE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [dbo].[LogTo_Debug](</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@Message </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">4000</span><span style="--0:#E1E4E8;--1:#E1E4E8">),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@CallingProc </span><span style="--0:#F97583;--1:#F97583">SYSNAME</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">AS</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">IF</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @CallingProc </span><span style="--0:#F97583;--1:#F97583">IS NOT NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogProperty_AddSourceContext @CallingProc</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">END</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogTo_Impl @Message, </span><span style="--0:#9ECBFF;--1:#9ECBFF">'debug'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">END</span></div></div></code><button class="copy-btn" aria-label="Copy code"><div class="copy-btn-icon"><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon copy-icon"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon success-icon"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div></button></pre></figure></div></section><section><h3 id="warning">Warning<a class="anchor" href="#warning"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">CREATE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">PROCEDURE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [dbo].[LogTo_Warning](</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@Message </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">4000</span><span style="--0:#E1E4E8;--1:#E1E4E8">),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@CallingProc </span><span style="--0:#F97583;--1:#F97583">SYSNAME</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">AS</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">IF</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @CallingProc </span><span style="--0:#F97583;--1:#F97583">IS NOT NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogProperty_AddSourceContext @CallingProc</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">END</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogTo_Impl @Message, </span><span style="--0:#9ECBFF;--1:#9ECBFF">'warn'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">END</span></div></div></code><button class="copy-btn" aria-label="Copy code"><div class="copy-btn-icon"><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon copy-icon"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon success-icon"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div></button></pre></figure></div></section><section><h3 id="information">Information<a class="anchor" href="#information"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">CREATE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">PROCEDURE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [dbo].[LogTo_Information](</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@Message </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">4000</span><span style="--0:#E1E4E8;--1:#E1E4E8">),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@CallingProc </span><span style="--0:#F97583;--1:#F97583">SYSNAME</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">AS</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">IF</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @CallingProc </span><span style="--0:#F97583;--1:#F97583">IS NOT NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogProperty_AddSourceContext @CallingProc</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">END</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogTo_Impl @Message, </span><span style="--0:#9ECBFF;--1:#9ECBFF">'info'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">END</span></div></div></code><button class="copy-btn" aria-label="Copy code"><div class="copy-btn-icon"><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon copy-icon"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon success-icon"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div></button></pre></figure></div></section><section><h3 id="verbose">Verbose<a class="anchor" href="#verbose"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">CREATE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">PROCEDURE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [dbo].[LogTo_Verbose](</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@Message </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">4000</span><span style="--0:#E1E4E8;--1:#E1E4E8">),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@CallingProc </span><span style="--0:#F97583;--1:#F97583">SYSNAME</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">AS</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">IF</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @CallingProc </span><span style="--0:#F97583;--1:#F97583">IS NOT NULL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogProperty_AddSourceContext @CallingProc</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">END</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogTo_Impl @Message, </span><span style="--0:#9ECBFF;--1:#9ECBFF">'trace'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">END</span></div></div></code><button class="copy-btn" aria-label="Copy code"><div class="copy-btn-icon"><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon copy-icon"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon success-icon"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div></button></pre></figure></div></section></section><section><h2 id="log-property-stack-1">Log Property Stack<a class="anchor" href="#log-property-stack-1"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>This is how you add additional context to your logs with some convenience functions below. They are just key value pairs that will get added to the log stream and can be parsed out using the Loki logQL within Grafana.</p><section><h3 id="implementation-1">Implementation<a class="anchor" href="#implementation-1"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">ALTER</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">PROCEDURE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [dbo].[LogProperty_Add](</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@Name </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">100</span><span style="--0:#E1E4E8;--1:#E1E4E8">),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@Value </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">4000</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">AS</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">BEGIN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">TRY</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--EXECUTE sp_set_session_context '__index__', '["ApplicationInstance", "CorrelationId"]'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--DECLARE @Name VARCHAR(100) = 'InstanceId'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- you cannot query values from the SESSION_CONTEXT without explicitly knowing the key</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- for this reason, we house a list of keys in a __index__ session value so we know what</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- to pull when we generate the actual log</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- add new key to property bag</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">DECLARE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @IndexKeys </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">4000</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @IndexKeys </span><span style="--0:#F97583;--1:#F97583">=</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">'['</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">+</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">ISNULL</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">STUFF</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#99A0A6;--1:#99A0A6">-- stuff select begin</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">',"'</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">+</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [Value] </span><span style="--0:#F97583;--1:#F97583">+</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">'"'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">FROM</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [value]</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">FROM</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#79B8FF;--1:#79B8FF">OPENJSON</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">CAST</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">SESSION_CONTEXT</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#9ECBFF;--1:#9ECBFF">N'__index__'</span><span style="--0:#E1E4E8;--1:#E1E4E8">) </span><span style="--0:#F97583;--1:#F97583">AS</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(MAX)))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">UNION</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">SELECT</span><span style="--0:#E1E4E8;--1:#E1E4E8"> @Name</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span style="--0:#E1E4E8;--1:#E1E4E8">) a([value])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">FOR</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">XML</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">PATH</span><span style="--0:#E1E4E8;--1:#E1E4E8"> (</span><span style="--0:#9ECBFF;--1:#9ECBFF">''</span><span style="--0:#E1E4E8;--1:#E1E4E8">)),</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span style="--0:#99A0A6;--1:#99A0A6">-- stuff select end</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">    </span><span style="--0:#79B8FF;--1:#79B8FF">1</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#79B8FF;--1:#79B8FF">1</span><span style="--0:#E1E4E8;--1:#E1E4E8">, </span><span style="--0:#9ECBFF;--1:#9ECBFF">''</span><span style="--0:#E1E4E8;--1:#E1E4E8">), </span><span style="--0:#9ECBFF;--1:#9ECBFF">''</span><span style="--0:#E1E4E8;--1:#E1E4E8">) </span><span style="--0:#F97583;--1:#F97583">+</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#9ECBFF;--1:#9ECBFF">']'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- persist new property bag</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> sp_set_session_context </span><span style="--0:#9ECBFF;--1:#9ECBFF">'__index__'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, @IndexKeys</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">--SELECT SESSION_CONTEXT(N'__index__')</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- persist log property</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> sp_set_session_context @Name, @Value</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">END</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">TRY</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">BEGIN</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">CATCH</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#99A0A6">-- swallow</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">END</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">CATCH</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">END</span></div></div></code><button class="copy-btn" aria-label="Copy code"><div class="copy-btn-icon"><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon copy-icon"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon success-icon"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div></button></pre></figure></div></section><section><h3 id="correlationid">CorrelationId<a class="anchor" href="#correlationid"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">ALTER</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">PROCEDURE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [dbo].[LogProperty_CorrelationId](</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@Value </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">4000</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">AS</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogProperty_Add </span><span style="--0:#9ECBFF;--1:#9ECBFF">'CorrelationId'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, @Value</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">END</span></div></div></code><button class="copy-btn" aria-label="Copy code"><div class="copy-btn-icon"><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon copy-icon"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon success-icon"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div></button></pre></figure></div></section><section><h3 id="sourcecontext">SourceContext<a class="anchor" href="#sourcecontext"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">ALTER</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">PROCEDURE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [dbo].[LogProperty_AddSourceContext](</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@Value </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">4000</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">AS</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogProperty_Add </span><span style="--0:#9ECBFF;--1:#9ECBFF">'SourceContext'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, @Value</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">END</span></div></div></code><button class="copy-btn" aria-label="Copy code"><div class="copy-btn-icon"><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon copy-icon"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon success-icon"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div></button></pre></figure></div></section><section><h3 id="instanceid">InstanceId<a class="anchor" href="#instanceid"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">ALTER</span><span style="--0:#E1E4E8;--1:#E1E4E8"> </span><span style="--0:#F97583;--1:#F97583">PROCEDURE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> [dbo].[LogProperty_InstanceId](</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#E1E4E8">  </span></span><span style="--0:#E1E4E8;--1:#E1E4E8">@Value </span><span style="--0:#F97583;--1:#F97583">NVARCHAR</span><span style="--0:#E1E4E8;--1:#E1E4E8">(</span><span style="--0:#79B8FF;--1:#79B8FF">4000</span><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#E1E4E8;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">AS</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">BEGIN</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#F97583">EXECUTE</span><span style="--0:#E1E4E8;--1:#E1E4E8"> LogProperty_Add </span><span style="--0:#9ECBFF;--1:#9ECBFF">'InstanceId'</span><span style="--0:#E1E4E8;--1:#E1E4E8">, @Value</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F97583;--1:#F97583">END</span></div></div></code><button class="copy-btn" aria-label="Copy code"><div class="copy-btn-icon"><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon copy-icon"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"></path></svg><svg viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" class="copy-btn-icon success-icon"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"></path></svg></div></button></pre></figure></div><p>~ SK</p></section></section></section>  </div> <script type="module">document.addEventListener("click",function(s){const t=s.target;if(t&&t.classList.contains("copy-btn")){const c=t.closest("pre")?.querySelector("code"),i=Array.from(c?.querySelectorAll(".code:not(summary *)")??[]).map(e=>e.textContent).map(e=>e===`
`?"":e).join(`
`);navigator.clipboard.writeText(i);const o=t.getAttribute("data-timeout-id");o&&clearTimeout(parseInt(o)),t.classList.add("success");const n=setTimeout(()=>{t.classList.remove("success")},1e3);t.setAttribute("data-timeout-id",n.toString())}});</script> <div class="mb-6 rounded-xl onload-animation"> <script src="https://giscus.app/client.js" data-repo="lostinspiration/lostinspiration.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkzNjk1NTQ1ODY=" data-category="Announcements" data-category-id="DIC_kwDOFgb0ms4Cz-JL" data-mapping="pathname" data-strict="0" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="bottom" data-theme="dark" data-lang="en" data-loading="lazy" crossorigin="anonymous" async>
              </script> </div> <div class="relative transition overflow-hidden bg-[var(--license-block-bg)] py-5 px-6 mb-6 rounded-xl license-container onload-animation"> <div class="transition font-bold text-black/75 dark:text-white/75"> Deforestation (Logging) </div> <a href="https://www.kichka.dev/posts/deforestation/" class="link text-[var(--primary)]"> https://www.kichka.dev/posts/deforestation/ </a> <div class="flex gap-6 mt-2"> <div> <div class="transition text-black/30 dark:text-white/30 text-sm">Author</div> <div class="transition text-black/75 dark:text-white/75 line-clamp-2">Stephen Kichka</div> </div> <div> <div class="transition text-black/30 dark:text-white/30 text-sm">Published at</div> <div class="transition text-black/75 dark:text-white/75 line-clamp-2">2025-12-30</div> </div> <div> <div class="transition text-black/30 dark:text-white/30 text-sm">License</div> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" class="link text-[var(--primary)] line-clamp-2">CC BY-NC-SA 4.0</a> </div> </div> <svg width="0.97em" height="1em" class="transition text-[15rem] absolute pointer-events-none right-6 top-1/2 -translate-y-1/2 text-black/5 dark:text-white/5" data-icon="fa6-brands:creative-commons">   <symbol id="ai:fa6-brands:creative-commons" viewBox="0 0 496 512"><path fill="currentColor" d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86m143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86M247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248m.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82"/></symbol><use href="#ai:fa6-brands:creative-commons"></use>  </svg> </div> </div> </div> <div class="flex flex-col md:flex-row justify-between mb-4 gap-4 overflow-hidden w-full"> <a href="#" class="w-full font-bold overflow-hidden active:scale-95 pointer-events-none">  </a> <a href="/posts/sql-quirky-update/" class="w-full font-bold overflow-hidden active:scale-95"> <div class="btn-card rounded-2xl w-full h-[3.75rem] max-w-full px-4 flex items-center !justify-end gap-4"> <div class="overflow-hidden transition overflow-ellipsis whitespace-nowrap max-w-[calc(100%_-_3rem)] text-black/75 dark:text-white/75"> SQL Server Quirky Update </div> <svg width="1em" height="1em" class="text-[2rem] text-[var(--primary)]" data-icon="material-symbols:chevron-right-rounded">   <symbol id="ai:material-symbols:chevron-right-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M12.6 12L8.7 8.1q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l4.6 4.6q.15.15.213.325t.062.375t-.062.375t-.213.325l-4.6 4.6q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7z"/></symbol><use href="#ai:material-symbols:chevron-right-rounded"></use>  </svg> </div> </a> </div>  <div class="footer col-span-2 onload-animation hidden lg:block"> <!--<div class="border-t border-[var(&#45;&#45;primary)] mx-16 border-dashed py-8 max-w-[var(&#45;&#45;page-width)] flex flex-col items-center justify-center px-6">--><div class="transition border-t border-black/10 dark:border-white/15 my-10 border-dashed mx-32"></div> <!--<div class="transition bg-[oklch(92%_0.01_var(&#45;&#45;hue))] dark:bg-black rounded-2xl py-8 mt-4 mb-8 flex flex-col items-center justify-center px-6">--> <div class="transition border-dashed border-[oklch(85%_0.01_var(--hue))] dark:border-white/15 rounded-2xl mb-12 flex flex-col items-center justify-center px-6"> <div class="transition text-50 text-sm text-center">
&copy; <span id="copyright-year">2026</span> Stephen Kichka. All Rights Reserved. /
<a class="transition link text-[var(--primary)] font-medium" target="_blank" href="/rss.xml">RSS</a> /
<a class="transition link text-[var(--primary)] font-medium" target="_blank" href="/sitemap-index.xml">Sitemap</a><br>
Powered by
<a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://astro.build">Astro</a> &
<a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://github.com/saicaca/fuwari">Fuwari</a> </div> </div> </div> </div> </main> <div class="footer col-span-2 onload-animation block lg:hidden"> <!--<div class="border-t border-[var(&#45;&#45;primary)] mx-16 border-dashed py-8 max-w-[var(&#45;&#45;page-width)] flex flex-col items-center justify-center px-6">--><div class="transition border-t border-black/10 dark:border-white/15 my-10 border-dashed mx-32"></div> <!--<div class="transition bg-[oklch(92%_0.01_var(&#45;&#45;hue))] dark:bg-black rounded-2xl py-8 mt-4 mb-8 flex flex-col items-center justify-center px-6">--> <div class="transition border-dashed border-[oklch(85%_0.01_var(--hue))] dark:border-white/15 rounded-2xl mb-12 flex flex-col items-center justify-center px-6"> <div class="transition text-50 text-sm text-center">
&copy; <span id="copyright-year">2026</span> Stephen Kichka. All Rights Reserved. /
<a class="transition link text-[var(--primary)] font-medium" target="_blank" href="/rss.xml">RSS</a> /
<a class="transition link text-[var(--primary)] font-medium" target="_blank" href="/sitemap-index.xml">Sitemap</a><br>
Powered by
<a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://astro.build">Astro</a> &
<a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://github.com/saicaca/fuwari">Fuwari</a> </div> </div> </div> </div> <!-- There can't be a filter on parent element, or it will break `fixed` --><div class="back-to-top-wrapper hidden lg:block" data-astro-cid-eymb5ayk> <div id="back-to-top-btn" class="back-to-top-btn hide flex items-center rounded-2xl overflow-hidden transition" onclick="backToTop()" data-astro-cid-eymb5ayk> <button aria-label="Back to Top" class="btn-card h-[3.75rem] w-[3.75rem]" data-astro-cid-eymb5ayk> <svg width="1em" height="1em" class="mx-auto" data-astro-cid-eymb5ayk="true" data-icon="material-symbols:keyboard-arrow-up-rounded">   <symbol id="ai:material-symbols:keyboard-arrow-up-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="m12 10.8l-3.9 3.9q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7l4.6-4.6q.3-.3.7-.3t.7.3l4.6 4.6q.275.275.275.7t-.275.7t-.7.275t-.7-.275z"/></symbol><use href="#ai:material-symbols:keyboard-arrow-up-rounded"></use>  </svg> </button> </div> </div>  <script>
function backToTop() {
    window.scroll({ top: 0, behavior: 'smooth' });
}
</script> </div> </div>  <div class="absolute w-full z-0 hidden 2xl:block"> <div class="relative max-w-[var(--page-width)] mx-auto"> <!-- TOC component --> <div id="toc-wrapper" class="hidden lg:block transition absolute top-0 -right-[var(--toc-width)] w-[var(--toc-width)] items-center"> <div id="toc-inner-wrapper" class="fixed top-14 w-[var(--toc-width)] h-[calc(100vh_-_20rem)] overflow-y-scroll overflow-x-hidden hide-scrollbar"> <div id="toc" class="w-full h-full transition-swup-fade "> <div class="h-8 w-full"></div> <table-of-contents class="group"><a href="#the-software-stack" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold bg-[var(--toc-badge-bg)] text-[var(--btn-content)]">1</div><div class="transition text-sm text-50">The Software Stack</div></a><a href="#grafana" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-4"><div class="transition w-2 h-2 rounded-[0.1875rem] bg-[var(--toc-badge-bg)]"></div></div><div class="transition text-sm text-50">Grafana</div></a><a href="#loki" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-4"><div class="transition w-2 h-2 rounded-[0.1875rem] bg-[var(--toc-badge-bg)]"></div></div><div class="transition text-sm text-50">Loki</div></a><a href="#prometheus" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-4"><div class="transition w-2 h-2 rounded-[0.1875rem] bg-[var(--toc-badge-bg)]"></div></div><div class="transition text-sm text-50">Prometheus</div></a><a href="#logging-fundamentals" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold bg-[var(--toc-badge-bg)] text-[var(--btn-content)]">2</div><div class="transition text-sm text-50">Logging Fundamentals</div></a><a href="#log-key-events" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-4"><div class="transition w-2 h-2 rounded-[0.1875rem] bg-[var(--toc-badge-bg)]"></div></div><div class="transition text-sm text-50">Log Key Events</div></a><a href="#choose-appropriate-logging-level" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-4"><div class="transition w-2 h-2 rounded-[0.1875rem] bg-[var(--toc-badge-bg)]"></div></div><div class="transition text-sm text-50">Choose Appropriate Logging Level</div></a><a href="#bonus--logging-in-sql-server" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold bg-[var(--toc-badge-bg)] text-[var(--btn-content)]">3</div><div class="transition text-sm text-50">Bonus — Logging in SQL Server</div></a><a href="#configure" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-4"><div class="transition w-2 h-2 rounded-[0.1875rem] bg-[var(--toc-badge-bg)]"></div></div><div class="transition text-sm text-50">Configure</div></a><a href="#log-level-functions" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-4"><div class="transition w-2 h-2 rounded-[0.1875rem] bg-[var(--toc-badge-bg)]"></div></div><div class="transition text-sm text-50">Log Level Functions</div></a><a href="#implementation" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-8"><div class="transition w-1.5 h-1.5 rounded-sm bg-black/5 dark:bg-white/10"></div></div><div class="transition text-sm text-30">Implementation</div></a><a href="#fatal" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-8"><div class="transition w-1.5 h-1.5 rounded-sm bg-black/5 dark:bg-white/10"></div></div><div class="transition text-sm text-30">Fatal</div></a><a href="#error" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-8"><div class="transition w-1.5 h-1.5 rounded-sm bg-black/5 dark:bg-white/10"></div></div><div class="transition text-sm text-30">Error</div></a><a href="#debug" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-8"><div class="transition w-1.5 h-1.5 rounded-sm bg-black/5 dark:bg-white/10"></div></div><div class="transition text-sm text-30">Debug</div></a><a href="#warning" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-8"><div class="transition w-1.5 h-1.5 rounded-sm bg-black/5 dark:bg-white/10"></div></div><div class="transition text-sm text-30">Warning</div></a><a href="#information" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-8"><div class="transition w-1.5 h-1.5 rounded-sm bg-black/5 dark:bg-white/10"></div></div><div class="transition text-sm text-30">Information</div></a><a href="#verbose" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-8"><div class="transition w-1.5 h-1.5 rounded-sm bg-black/5 dark:bg-white/10"></div></div><div class="transition text-sm text-30">Verbose</div></a><a href="#log-property-stack-1" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-4"><div class="transition w-2 h-2 rounded-[0.1875rem] bg-[var(--toc-badge-bg)]"></div></div><div class="transition text-sm text-50">Log Property Stack</div></a><a href="#implementation-1" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-8"><div class="transition w-1.5 h-1.5 rounded-sm bg-black/5 dark:bg-white/10"></div></div><div class="transition text-sm text-30">Implementation</div></a><a href="#correlationid" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-8"><div class="transition w-1.5 h-1.5 rounded-sm bg-black/5 dark:bg-white/10"></div></div><div class="transition text-sm text-30">CorrelationId</div></a><a href="#sourcecontext" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-8"><div class="transition w-1.5 h-1.5 rounded-sm bg-black/5 dark:bg-white/10"></div></div><div class="transition text-sm text-30">SourceContext</div></a><a href="#instanceid" class="px-2 flex gap-2 relative transition w-full min-h-9 rounded-xl
        hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2
    "><div class="transition w-5 h-5 shrink-0 rounded-lg text-xs flex items-center justify-center font-bold ml-8"><div class="transition w-1.5 h-1.5 rounded-sm bg-black/5 dark:bg-white/10"></div></div><div class="transition text-sm text-30">InstanceId</div></a><div id="active-indicator" style="opacity: 0" class="-z-10 absolute bg-[var(--toc-btn-hover)] left-0 right-0 rounded-xl transition-all group-hover:bg-transparent border-2 border-[var(--toc-btn-hover)] group-hover:border-[var(--toc-btn-active)] border-dashed"></div></table-of-contents><script type="module">class l extends HTMLElement{tocEl=null;visibleClass="visible";observer;anchorNavTarget=null;headingIdxMap=new Map;headings=[];sections=[];tocEntries=[];active=[];activeIndicator=null;constructor(){super(),this.observer=new IntersectionObserver(this.markVisibleSection,{threshold:0})}markVisibleSection=t=>{t.forEach(e=>{const i=e.target.children[0]?.getAttribute("id"),s=i?this.headingIdxMap.get(i):void 0;s!=null&&(this.active[s]=e.isIntersecting),e.isIntersecting&&this.anchorNavTarget==e.target.firstChild&&(this.anchorNavTarget=null)}),this.active.includes(!0)||this.fallback(),this.update()};toggleActiveHeading=()=>{let t=this.active.length-1,e=this.active.length-1,i=-1;for(;t>=0&&!this.active[t];)this.tocEntries[t].classList.remove(this.visibleClass),t--;for(;t>=0&&this.active[t];)this.tocEntries[t].classList.add(this.visibleClass),e=Math.min(e,t),i=Math.max(i,t),t--;for(;t>=0;)this.tocEntries[t].classList.remove(this.visibleClass),t--;if(e>i)this.activeIndicator?.setAttribute("style","opacity: 0");else{let s=this.tocEl?.getBoundingClientRect().top||0,n=this.tocEl?.scrollTop||0,o=this.tocEntries[e].getBoundingClientRect().top-s+n,c=this.tocEntries[i].getBoundingClientRect().bottom-s+n;this.activeIndicator?.setAttribute("style",`top: ${o}px; height: ${c-o}px`)}};scrollToActiveHeading=()=>{if(this.anchorNavTarget||!this.tocEl)return;const t=document.querySelectorAll(`#toc .${this.visibleClass}`);if(!t.length)return;const e=t[0],i=t[t.length-1],s=this.tocEl.clientHeight;let n;i.getBoundingClientRect().bottom-e.getBoundingClientRect().top<.9*s?n=e.offsetTop-32:n=i.offsetTop-s*.8,this.tocEl.scrollTo({top:n,left:0,behavior:"smooth"})};update=()=>{requestAnimationFrame(()=>{this.toggleActiveHeading(),this.scrollToActiveHeading()})};fallback=()=>{if(this.sections.length)for(let t=0;t<this.sections.length;t++){let e=this.sections[t].getBoundingClientRect().top,i=this.sections[t].getBoundingClientRect().bottom;if(this.isInRange(e,0,window.innerHeight)||this.isInRange(i,0,window.innerHeight)||e<0&&i>window.innerHeight)this.markActiveHeading(t);else if(e>window.innerHeight)break}};markActiveHeading=t=>{this.active[t]=!0};handleAnchorClick=t=>{const e=t.composedPath().find(i=>i instanceof HTMLAnchorElement);if(e){const i=decodeURIComponent(e.hash?.substring(1)),s=this.headingIdxMap.get(i);s!==void 0?this.anchorNavTarget=this.headings[s]:this.anchorNavTarget=null}};isInRange(t,e,i){return e<t&&t<i}connectedCallback(){const t=document.querySelector(".prose");t?t.addEventListener("animationend",()=>{this.init()},{once:!0}):console.debug("Animation element not found")}init(){if(this.tocEl=document.getElementById("toc-inner-wrapper"),!!this.tocEl&&(this.tocEl.addEventListener("click",this.handleAnchorClick,{capture:!0}),this.activeIndicator=document.getElementById("active-indicator"),this.tocEntries=Array.from(document.querySelectorAll("#toc a[href^='#']")),this.tocEntries.length!==0)){this.sections=new Array(this.tocEntries.length),this.headings=new Array(this.tocEntries.length);for(let t=0;t<this.tocEntries.length;t++){const e=decodeURIComponent(this.tocEntries[t].hash?.substring(1)),i=document.getElementById(e),s=i?.parentElement;i instanceof HTMLElement&&s instanceof HTMLElement&&(this.headings[t]=i,this.sections[t]=s,this.headingIdxMap.set(e,t))}this.active=new Array(this.tocEntries.length).fill(!1),this.sections.forEach(t=>this.observer.observe(t)),this.fallback(),this.update()}}disconnectedCallback(){this.sections.forEach(t=>this.observer.unobserve(t)),this.observer.disconnect(),this.tocEl?.removeEventListener("click",this.handleAnchorClick)}}customElements.get("table-of-contents")||customElements.define("table-of-contents",l);</script> <div class="h-8 w-full"></div> </div> </div> </div> <!-- #toc needs to exist for Swup to work normally -->  </div> </div>  <!-- increase the page height during page transition to prevent the scrolling animation from jumping --> <div id="page-height-extend" class="hidden h-[300vh]" data-astro-cid-sckkx6r4 style="--bannerOffset: 15vh;--banner-height-home: 65vh;--banner-height: 35vh;--configHue: 250;--page-width: 75rem;"></div>  <script type="module" src="/_astro/Layout.astro_astro_type_script_index_0_lang.DAHrxWCB.js"></script> <script type="module" src="/_astro/Layout.astro_astro_type_script_index_1_lang.XOwjXvf7.js"></script></body></html>